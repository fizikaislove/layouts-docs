Upgrading from 0.11.0 to 0.12.0
===============================

Upgrade ``composer.json``
-------------------------

In your ``composer.json`` file, upgrade the version of ``netgen/block-manager``
package and all other related packages (like ``netgen/block-manager-standard``,
``netgen/block-manager-ezpublish`` and others) to ``~0.12.0`` and run the
``composer update`` command.

Database migration
------------------

Run the following command from the root of your installation to execute
migration to version 0.12 of Netgen Layouts:

.. code-block:: shell

    $ php bin/console doctrine:migrations:migrate --configuration=vendor/netgen/block-manager/migrations/doctrine.yml

Upgrading Netgen Content Browser
--------------------------------

Netgen Content Browser version 0.12 was also automatically installed. Be sure to
read `its upgrade instructions </projects/cb/en/latest/upgrades/upgrade_0110_0120.html>`_
too, to make sure you custom code keeps working.

Breaking changes
----------------

* Minimum required version of PHP is now 7.1

* Layouts exported in Netgen Layouts 0.11 and lower cannot be imported into
  Netgen Layouts 0.12, due to updated specification.

* ``Netgen\Bundle\CoreUIBundle\NetgenCoreUIBundle`` bundle has been removed.
  Remove it from your ``AppKernel`` class.

* First argument to ``ngbm:import`` command, import type, was removed. Now the
  first (and only) argument is the path to file to import data from.

* ``Netgen\BlockManager\Parameters\ParameterTypeInterface::getIdentifier``
  method has been declared static. Make the method static on your custom
  parameter types to migrate.

* ``Netgen\BlockManager\Layout\Resolver\TargetTypeInterface::getType`` method
  has been declared static. Make the method static on your custom target types
  to migrate.

* ``Netgen\BlockManager\Layout\Resolver\ConditionTypeInterface::getType`` method
  has been declared static. Make the method static on your custom condition
  types to migrate.

* ``Netgen\BlockManager\Block\BlockDefinition\ContainerDefinitionHandler``
  abstract class has been removed since it was made obsolete in previous
  versions of Netgen Layouts. Implement ``ContainerDefinitionHandlerInterface``
  interface from the same namespace directly in your handlers. Also, if you
  referenced this class in your block plugins in ``getExtendedHandler`` method,
  replace it also with ``ContainerDefinitionHandlerInterface`` interface.

* ``Netgen\BlockManager\Item\ValueLoaderInterface::load`` and
  ``Netgen\BlockManager\Item\ValueLoaderInterface::loadByRemoteId`` methods for
  your custom value loaders have been changed to return ``null`` if the value
  cannot be loaded. To migrate, remove throwing of ``ItemException`` and simply
  return ``null`` instead.

* ``netgen_block_manager.items.value_types`` configuration has been renamed to
  ``netgen_block_manager.value_types``. To migrate your custom value types, just
  delete the ``items`` key and move ``value_types`` config directly below
  ``netgen_block_manager`` key.

  .. code-block:: yaml

      # Before

      netgen_block_manager:
          items:
              value_types:
                  my_type:
                      name: 'My type'

  .. code-block:: yaml

      # After

      netgen_block_manager:
          value_types:
              my_type:
                  name: 'My type'
